<%inherit file="layout.html" />

<%! from pprint import pformat %>

<%def name="vartable(vars, show_none=True)">
% if vars is None:
% if show_none:
<pre>None</pre>
% endif
% else:
<pre>
% for n, v in sorted(vars.items()):
${n} = ${pformat(v, width=20) | h}
% endfor
</pre>
% endif
</%def>

<div class="page-header">
  <ul class="breadcrumb">
    <li><a href="/runs">Runs</a> <span class="divider">|</span></li>
    <li class="active">${run_id}</li>
  </ul>
  <table class="table">
    <tr><th>CWD</th><td>${run.cwd}</td></tr>
    <tr><th>Description</th><td>${run.description}</td></tr>
    <tr><th>Start</th><td>${run.start_time}</td></tr>
    <tr><th>End</th><td>${run.end_time}</td></tr>
% if run.error_message:
    <tr class="error"><th>Error</th><td>${run.error_message}</td></tr>
% endif
  </table>
</div>

<div class="row-fluid">
  <div id="content" class="span12">

    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>Event</th>
          <th>Filename</th>
          <th>Line</th>
          <th>Function</th>
          <th>Statement</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody>
% for t in trace:
        <tr>
          <td>${t.event}</td>
          <td><a href="/runs/${run_id}/files/${getfileid(filename=t.filename)}">${t.filename|self.display_filename}</a></td>
          <td>${t.line_no}</td>
          <td>${t.func_name}</td>
          <td><pre>${getline(t.filename, t.line_no)}</pre></td>
% if t.event == 'return':
          <td><pre>${pformat(t.trace_arg, width=20)}</pre></td>
% elif t.event == 'call':
          <td>${vartable(t.trace_arg, show_none=False)}</td>
% elif not t.local_vars:
          <td></td>
% else:
          <td>${vartable(t.local_vars)}</td>
% endif
        </tr>
% endfor        
      </tbody>
    </table>

  </div>
</div>
